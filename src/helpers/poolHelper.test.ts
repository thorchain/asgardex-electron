import BigNumber from 'bignumber.js'

import { PriceDataIndex, PoolDetailsMap } from '../services/midgard/types'
import { PoolDetailStatusEnum } from '../types/generated/midgard'
import { getPoolViewData } from './poolHelper'

describe('poolHelper', () => {
  describe('getPoolViewData', () => {
    it('return PoolViewData', () => {
      const poolDetails: PoolDetailsMap = {
        'TOMOB-1E1': {
          asset: 'BNB.TOMOB-1E1',
          assetDepth: '18446742858123318865',
          assetROI: '20667660.85795645',
          assetStakedTotal: '1044674093274',
          buyAssetCount: '36',
          buyFeeAverage: '10291935822.907797',
          buyFeesTotal: '370509689624',
          buySlipAverage: '0.13204722398788565',
          buyTxAverage: '84802745137.44766',
          buyVolume: '3052898824948',
          poolDepth: '18446717002400377230',
          poolFeeAverage: '6555438775.205882',
          poolFeesTotal: '445769836714',
          poolROI: '14060601.737624915',
          poolROI12: '14060601.737624915',
          poolSlipAverage: '0.3197441186194363',
          poolStakedTotal: '3682199542975',
          poolTxAverage: '58669549406.92824',
          poolUnits: '1689199469669',
          poolVolume: '21102028120401',
          poolVolume24hr: '21102028120401',
          price: '0.9999993321277123',
          runeDepth: '18446730538054964423',
          runeROI: '7453542.617293379',
          runeStakedTotal: '2637526147410',
          sellAssetCount: '32',
          sellFeeAverage: '2351879596.5625',
          sellFeesTotal: '75260147090',
          sellSlipAverage: '0.5309031250799308',
          sellTxAverage: '29269704210.093884',
          sellVolume: '18049129295453',
          stakeTxCount: '37',
          stakersCount: '22',
          stakingTxCount: '48',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '68',
          withdrawTxCount: '11'
        },
        'LOK-3C0': {
          asset: 'BNB.LOK-3C0',
          assetDepth: '37424296744',
          assetROI: '0.328218990570089',
          assetStakedTotal: '28176300000',
          buyAssetCount: '9',
          buyFeeAverage: '208491058.14241052',
          buyFeesTotal: '1876419523',
          buySlipAverage: '0.2013888888888889',
          buyTxAverage: '1566610377.3971372',
          buyVolume: '14099493396',
          poolDepth: '48673495212',
          poolFeeAverage: '600993113.3846154',
          poolFeesTotal: '7812910474',
          poolROI: '0.1384894550884584',
          poolROI12: '0.1384894550884584',
          poolSlipAverage: '0.38851538801995605',
          poolStakedTotal: '43973955359',
          poolTxAverage: '2529481811.70531',
          poolUnits: '26913706341',
          poolVolume: '21541614020',
          poolVolume24hr: '21541614020',
          price: '0.6502927168538379',
          runeDepth: '24336747606',
          runeROI: '-0.05124008039317224',
          runeStakedTotal: '25651112682',
          sellAssetCount: '4',
          sellFeeAverage: '1484122737.75',
          sellFeesTotal: '5936490951',
          sellSlipAverage: '0.8095500110648572',
          sellTxAverage: '4695942538.898699',
          sellVolume: '7442120624',
          stakeTxCount: '6',
          stakersCount: '5',
          stakingTxCount: '6',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '13',
          withdrawTxCount: '0'
        },
        'BOLT-E42': {
          asset: 'BNB.BOLT-E42',
          assetDepth: '18446743420523926728',
          assetROI: '151586055.02546698',
          assetStakedTotal: '122018650092',
          buyAssetCount: '9',
          buyFeeAverage: '0.6805646594055487',
          buyFeesTotal: '6',
          buySlipAverage: '0.04975555568105645',
          buyTxAverage: '700.5684392037332',
          buyVolume: '6305',
          poolDepth: '299879750322',
          poolFeeAverage: '0.6666666666666666',
          poolFeesTotal: '6',
          poolROI: '75793027.61991315',
          poolROI12: '75793027.61991315',
          poolSlipAverage: '0.04975555568105645',
          poolStakedTotal: '123915426389',
          poolTxAverage: '700.5684392037332',
          poolUnits: '122589177745',
          poolVolume: '6305',
          poolVolume24hr: '6305',
          price: '0.000000008128257207403678',
          runeDepth: '149939875161',
          runeROI: '0.21435932665378687',
          runeStakedTotal: '123915425398',
          sellAssetCount: '0',
          sellFeeAverage: '0',
          sellFeesTotal: '0',
          sellSlipAverage: '0',
          sellTxAverage: '0',
          sellVolume: '0',
          stakeTxCount: '7',
          stakersCount: '4',
          stakingTxCount: '8',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '9',
          withdrawTxCount: '1'
        },
        'FTM-585': {
          asset: 'BNB.FTM-585',
          assetDepth: '3895825664',
          assetROI: '-0.18148567020699732',
          assetStakedTotal: '4759630372',
          buyAssetCount: '16',
          buyFeeAverage: '5428443548.368362',
          buyFeesTotal: '86855096773',
          buySlipAverage: '0.6264937485102564',
          buyTxAverage: '3129608317.1009145',
          buyVolume: '50073733073',
          poolDepth: '395632105590',
          poolFeeAverage: '5428443548.3125',
          poolFeesTotal: '86855096773',
          poolROI: '4.175977955919985',
          poolROI12: '4.175977955919985',
          poolSlipAverage: '0.6264937485102564',
          poolStakedTotal: '262426657378',
          poolTxAverage: '3129608317.1009145',
          poolUnits: '12585946035',
          poolVolume: '50073733073',
          poolVolume24hr: '50073733073',
          price: '50.776412975290675',
          runeDepth: '197816052795',
          runeROI: '8.533441582046969',
          runeStakedTotal: '20749700000',
          sellAssetCount: '0',
          sellFeeAverage: '0',
          sellFeesTotal: '0',
          sellSlipAverage: '0',
          sellTxAverage: '0',
          sellVolume: '0',
          stakeTxCount: '4',
          stakersCount: '4',
          stakingTxCount: '4',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '16',
          withdrawTxCount: '0'
        },
        BNB: {
          asset: 'BNB.BNB',
          assetDepth: '18446743758877128975',
          assetROI: '0',
          assetStakedTotal: '120944035625',
          buyAssetCount: '81',
          buyFeeAverage: '0.8513360028148589',
          buyFeesTotal: '68',
          buySlipAverage: '0.027346913402944654',
          buyTxAverage: '114.38820756795185',
          buyVolume: '9265',
          poolDepth: '863236374028',
          poolFeeAverage: '3770918685.5820894',
          poolFeesTotal: '505303103868',
          poolROI: '-0.4662910843337216',
          poolROI12: '-0.4662910843337216',
          poolSlipAverage: '0.04584029887185203',
          poolStakedTotal: '12378003128265',
          poolTxAverage: '88.54340099864292',
          poolUnits: '1916670949256',
          poolVolume: '8257720116699',
          poolVolume24hr: '8195633950903',
          price: '0.00000002339806920157886',
          runeDepth: '431618187014',
          runeROI: '-0.9325821686674431',
          runeStakedTotal: '12378003125436',
          sellAssetCount: '53',
          sellFeeAverage: '9534020826.415094',
          sellFeesTotal: '505303103800',
          sellSlipAverage: '0.07410377477716329',
          sellTxAverage: '49.04473435498212',
          sellVolume: '8257720107434',
          stakeTxCount: '55',
          stakersCount: '21',
          stakingTxCount: '71',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '4',
          swappingTxCount: '134',
          withdrawTxCount: '16'
        },
        'MEOW-E85': {
          asset: 'BNB.MEOW-E85',
          assetDepth: '18446190505358052326',
          assetROI: '0',
          assetStakedTotal: '104797218400000',
          buyAssetCount: '15',
          buyFeeAverage: '25605683051.353394',
          buyFeesTotal: '384085245770',
          buySlipAverage: '0.021593333315104248',
          buyTxAverage: '22123280315688.344',
          buyVolume: '331849204735325',
          poolDepth: '18446738671771165142',
          poolFeeAverage: '24106266139.8125',
          poolFeesTotal: '385700258237',
          poolROI: '0',
          poolROI12: '0',
          poolSlipAverage: '0.025243749871151522',
          poolStakedTotal: '105855348587075',
          poolTxAverage: '20963207000082.516',
          poolUnits: '51352415014955',
          poolVolume: '331890373853407',
          poolVolume24hr: '331890373853407',
          price: '1.0000298634768054',
          runeDepth: '18446741372740358379',
          runeROI: '0',
          runeStakedTotal: '1055000577775',
          sellAssetCount: '1',
          sellFeeAverage: '1615012467',
          sellFeesTotal: '1615012467',
          sellSlipAverage: '0.07999999821186066',
          sellTxAverage: '3562107265995.0273',
          sellVolume: '41169118082',
          stakeTxCount: '8',
          stakersCount: '4',
          stakingTxCount: '12',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '3',
          swappingTxCount: '16',
          withdrawTxCount: '4'
        },
        'TUSDB-000': {
          asset: 'BNB.TUSDB-000',
          assetDepth: '18446743237290338555',
          assetROI: '42874152.42689522',
          assetStakedTotal: '434860923760',
          buyAssetCount: '35',
          buyFeeAverage: '61.0604652448018',
          buyFeesTotal: '2137',
          buySlipAverage: '0.037225714744584235',
          buyTxAverage: '6533.116988262293',
          buyVolume: '228659',
          poolDepth: '5690919745038',
          poolFeeAverage: '2132929380.5',
          poolFeesTotal: '127975762830',
          poolROI: '21437076.193104398',
          poolROI12: '21437076.193104398',
          poolSlipAverage: '0.045415000200106685',
          poolStakedTotal: '3004422562960',
          poolTxAverage: '4363.222350276931',
          poolUnits: '1717581729693',
          poolVolume: '1496232157357',
          poolVolume24hr: '1358519290235',
          price: '0.0000001542526957694551',
          runeDepth: '2845459872519',
          runeROI: '-0.04068642865571774',
          runeStakedTotal: '3004422495882',
          sellAssetCount: '25',
          sellFeeAverage: '5119030427.72',
          sellFeesTotal: '127975760693',
          sellSlipAverage: '0.05687999983783811',
          sellTxAverage: '1325.3698570974245',
          sellVolume: '1496231928698',
          stakeTxCount: '25',
          stakersCount: '17',
          stakingTxCount: '30',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '60',
          withdrawTxCount: '5'
        },
        'TCAN-014': {
          asset: 'BNB.TCAN-014',
          assetDepth: '2424033495184',
          assetROI: '1.334108269091496',
          assetStakedTotal: '1039883988671',
          buyAssetCount: '12',
          buyFeeAverage: '64239911.359147295',
          buyFeesTotal: '770878936',
          buySlipAverage: '0.015933333429226575',
          buyTxAverage: '1324871032.8620007',
          buyVolume: '15898452394',
          poolDepth: '902727028326',
          poolFeeAverage: '2304655467.6296296',
          poolFeesTotal: '62225697626',
          poolROI: '0.38485878012558505',
          poolROI12: '0.38485878012558505',
          poolSlipAverage: '0.0822370375492567',
          poolStakedTotal: '1231010025969',
          poolTxAverage: '10712980014.492334',
          poolUnits: '1037368928784',
          poolVolume: '610852972538',
          poolVolume24hr: '610852972538',
          price: '0.18620349721229348',
          runeDepth: '451363514163',
          runeROI: '-0.5643907088403259',
          runeStakedTotal: '1037379990584',
          sellAssetCount: '15',
          sellFeeAverage: '4096987912.6666665',
          sellFeesTotal: '61454818690',
          sellSlipAverage: '0.13528000084528077',
          sellTxAverage: '18223467199.7966',
          sellVolume: '594954520144',
          stakeTxCount: '10',
          stakersCount: '6',
          stakingTxCount: '12',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '2',
          swappingTxCount: '27',
          withdrawTxCount: '2'
        },
        'SIMP-0C4': {
          asset: 'BNB.SIMP-0C4',
          assetDepth: '18446223316771404208',
          assetROI: '168788.79025091746',
          assetStakedTotal: '109706540572991',
          buyAssetCount: '23',
          buyFeeAverage: '3041.884810458752',
          buyFeesTotal: '69963',
          buySlipAverage: '0.02437391272763742',
          buyTxAverage: '1538575.690990073',
          buyVolume: '35387240',
          poolDepth: '2063701715860',
          poolFeeAverage: '136381.99159663866',
          poolFeesTotal: '16229457',
          poolROI: '84394.34417414523',
          poolROI12: '84394.34417414523',
          poolSlipAverage: '0.004934453718734029',
          poolStakedTotal: '1153940900443',
          poolTxAverage: '298044.9564957185',
          poolUnits: '55703021354861',
          poolVolume: '402854578741',
          poolVolume24hr: '402854578741',
          price: '0.00000005593832624761925',
          runeDepth: '1031850857930',
          runeROI: '-0.10190262701227899',
          runeStakedTotal: '1153934763643',
          sellAssetCount: '96',
          sellFeeAverage: '168328.0625',
          sellFeesTotal: '16159494',
          sellSlipAverage: '0.000277083331184258',
          sellTxAverage: '834.4680231127271',
          sellVolume: '402819191501',
          stakeTxCount: '9',
          stakersCount: '5',
          stakingTxCount: '12',
          status: PoolDetailStatusEnum.Enabled,
          swappersCount: '1',
          swappingTxCount: '119',
          withdrawTxCount: '3'
        }
      }
      const priceIndex: PriceDataIndex = {
        RUNE: new BigNumber(1),
        TOMOB: new BigNumber(0.9999993354396914),
        LOK: new BigNumber(0.6502927168538379),
        BOLT: new BigNumber(8.128257207403678e-9),
        FTM: new BigNumber(41.40345498067955),
        BNB: new BigNumber(2.339806920157886e-8),
        MEOW: new BigNumber(1.0000298634768054),
        TUSDB: new BigNumber(1.542526957694551e-7),
        TCAN: new BigNumber(0.18620349721229348),
        SIMP: new BigNumber(5.593832624761925e-8)
      }
      const result = getPoolViewData({
        poolAssets: [],
        assetDetails: [],
        assetDetailIndex: {},
        poolDetails,
        priceIndex
      })

      expect(result.length).toEqual(9)

      expect(result[0].key).toEqual('TOMOB-1E1')
      expect(result[1].key).toEqual('LOK-3C0')
      expect(result[2].key).toEqual('BOLT-E42')
      expect(result[3].key).toEqual('FTM-585')
      expect(result[4].key).toEqual('BNB')
      expect(result[5].key).toEqual('MEOW-E85')
      expect(result[6].key).toEqual('TUSDB-000')
      expect(result[7].key).toEqual('TCAN-014')
      expect(result[8].key).toEqual('SIMP-0C4')

      expect(result[0].pool.target).toEqual('TOMOB')
      expect(result[1].poolPrice).toEqual('RUNE 0.650')
      expect(result[2].depth).toEqual('RUNE 1,499.40')
      expect(result[3].volume).toEqual('RUNE 500.74')
      expect(result[4].transaction).toEqual('RUNE 0.00')
      expect(result[5].slip).toEqual('2.5243749871151522')
      expect(result[6].trade).toEqual('60')
    })
  })
})
